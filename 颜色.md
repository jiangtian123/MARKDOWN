# 颜色
## 光和颜色
什么是光
> 光通常指的是人类眼睛可以见的电磁波（可见光），视知觉就是对于可见光的知觉。可见光只是电磁波谱上的某一段频谱，一般是定义为波长介于400至700奈（纳）米（nm）之间的电磁波，也就是波长比紫外线长，比红外线短的电磁波。有些资料来源定义的可见光的波长范围也有不同，较窄的有介于420至680nm，较宽的有介于380至800nm。……光既是一种高频的电磁波，又是一种由称为光子的基本粒子组成的粒子流。因此光同时具有粒子性与波动性，或者说光具有“波粒二象性”。
> 
> ——From wiki

简洁来说，光是一种能量，可以以电磁波的形式传递。将复色光通过棱镜等色散系统分光后，按照光的波长或者频率大小依次排列成图案，就得到了光谱。

光谱中只有一部分的光是可见的，波长大概在400nm到750nm之间，这部分为成为可见光。

那什么是颜色呢？
> 颜色是眼、脑和我们的生活经验对光的颜色类别描述的视觉感知特征，其名称有红色、橙色、黄色、绿色、蓝色或紫色。这种对颜色的感知来自可见光谱中的电磁辐射对人眼视锥细胞的刺激。颜色的种类和颜色的物理规格是通过反射光的波长与物体相联系的。这种反射是由物体的物理性质决定的，如光的吸收、发射光谱等。但人对颜色的感觉不仅仅由光的物理性质所决定，还包含心理等许多因素，比如人类对颜色的感觉往往受到周围颜色的影响。  
—— From wiki

一种表示光的方式为——光谱能量分布图。横坐标为波长，纵坐标为波长的单位能量

<img src=https://agraphicsguy.files.wordpress.com/2018/11/pmc4168854_cia-9-1527fig1.png />

所以姑且可以认为，不同波长的光就是我们看到的颜色

## 人眼怎么看到颜色
简单来说，人眼在视网膜上感知光的细胞有两种

——视杆细胞，用来感知亮度。

——视锥细胞，用来感知颜色。

其中，视锥细胞有三个分类，分别为**S-视锥细胞**，**M-视锥细胞**，**L-视锥细胞**。分别对应着波长的短中长。

一般来说，S-视锥细胞对波长420nm的光线最为敏感，M-视锥细胞530nm的波长最为敏感，而L-视锥细胞对于560nm的波长最为敏感。

下图是三种细胞对不同波长的敏感程度，横坐标为波长，纵坐标为敏感度

<img src=https://pic2.zhimg.com/80/v2-a00c5c7a51a13868cafe4291c064b43e_720w.jpg />

也就是说，光的光谱无论多么复杂，人眼只对光谱中的特定三个波长的敏感，而”颜色“也是这三种波长复合而来。由此可得，即便有两个光谱能量分布完全不一样的复色光，在我们人眼看来它们可能是同样的“颜色”，只要它们对视锥细胞产生的刺激是一致的。

##  量化颜色：Color Matching Functions

用光谱能量分布图表示颜色，需要记录的信息太多，于是受人眼启发，人们选取了三个单波长光，来表示可见光。

这就是**等色匹配实验（color matching experiment**选取三个单波长光，把它们称为primaries（三元光）。对于可见光谱中的每一个单波长光，找出三个参数分别对应每个三元光的强度，使得人眼对它们的颜色感知是一致的。这样对可见光谱中的所有单波长光进行测量，我们就可以得到一组函数r(λ)、g(λ)、b(λ)，把它们画到 一张表上就是：

<img src=https://agraphicsguynotes.com/img/posts/basic_color_science_for_graphcis_engineer/the-color-matching-functions.png />

> 如：450nm的单色光约等于**1.0*B($\lambda$)+0*G($\lambda$)+0*R($\lambda$)**

历史上做了很多这样的等色匹配实验，其中最著名也是应用最广泛（之一）的是1931年的CIE 1931 RGB Color Matching Functions。CIE（International Commission on Illumination，那为啥缩写不是COI而是CIE呢，因为缩写来源于它的法语名2333）是一个1913年成立的组织，致力于制定国际通用的和光与颜色相关的标准。CIE 1931 RGB使用的三元光波长分别是700nm（R）、546.1nm（G）、435.8nm（B）。

> 可以注意到，700nm（R）的波长会取到负值，这是由于，在实验室有些波长不可以通过三元光*正系数得到。
如 待测试的波长为A ， 无论怎么调整RGB的系数都得不到A，这时就会通过让A加上一个波长B即 A+B = x*r(λ)+y*g(λ)+z*b(λ);随后把B移过去，有时就会产生负值。

### 取消负值
由于RGB color space 中有负值，于是有人便转换到了一个XYZ颜色空间，使用一个3x3的空间变换矩阵在两个颜色空间做转换。

XYZ color space有很多好处，最明显的特点就是XYZ color matching functions全是正值，另一个特点是它的Y轴是刻意挑选出来的，它的走向和亮度函数是匹配的，也就是说Y值越大亮度也会越大。
<img src= https://miro.medium.com/max/1400/0*DoaKfjUiL8U4YD0y. />

### 再次降维
XYZ color space虽然很好，但要在这样一个三维空间里讨论一个颜色还是有点困难。很多时候我们其实只关心颜色的色度和饱和度，不关心它的亮度，这意味着我们可以把颜色表示从三维降维到二维表示。通常来说，我们可以把一个颜色从XYZ color space投影到X + Y + Z = 1的平面上。这个二维色度空间（chromaticity color space）就被称为CIE 1931 xyz color space。有了x + y + z = 1这个约束，实际上我们只需要两个值就可以指定一个色度（chromaticity）。通常，我们选择留下xy丢掉z，即把上述x + y + z = 1的平面再投影到XY平面上，这样我们就可以只使用xy值来指定一个色度了。

降维以后的xy色度图
<image src = https://pic3.zhimg.com/80/v2-ddf765c51433424bb163a63e9f59d462_720w.jpg />
> 色度图的边缘线代表各个波长的单色光对应的颜色，即光谱轨迹（spectral locus）。  
> 光谱轨迹线所围成的区域代表了通过混合各种不同波长单色光我们能感知到的颜色。

为什么Y可以代表亮度？

因为人眼对绿光波长最敏感，RGB系统三原色的相对亮度（不是数量的多少）比为： $L_r:L_g:L_b = 1.000:4.5907:0.0601$ （这意味着蓝色给人的感觉非常暗,绿色给人感觉最亮）。因此这里设置原色Y代表亮度和绿色的在颜色中的比例也比较也合理（颜色Y值越大，人眼感觉越亮，也代表颜色中绿色的比例越高）。

另外由于颜色匹配也包括其亮度的匹配，因此方程(1)可以将三原色相对亮度代入可得到亮度方程 $L(C) = r+ 4.5907g+0.0601b$，如果颜色在无亮度$L(C) = 0$ 线上，则$r+ 4.5907g+0.0601b = 0$ , 代入$b = 1-r-g$ ，整理后可得 XZ 线的方程。

## 颜色空间
上面说到，我们定义了一个**CIE 1931 xyz color space**,这个颜色空间基本包含了我们能感知到的最大色域，所以**CIE 1931 xyz color space**成为我们定义其他色域的标准空间。

通常，我们工作的色域范围并不是**CIE 1931 xyz color space**所涵盖的范围，而是在此基础上的一个RGB颜色空间。

<image src = https://www.colour-science.org/images/Colour_-_Analysis_CIE_xyY.gif />

上图右侧是一个三维的RGB颜色空间。为了方便可视化们通常会在CIE 1931 xy色度图里来表示它的色度范围（右下图），上面的黑点表示右上图的所有像素在这个RGB颜色空间的位置。

### 如何定义一个RGB颜色空间呢
- 三原色（Primaries）
- 白点（Whitepoint）
- 传递函数（Transfer Functions）
#### 三原色（Primaries）
此处的三原色和文章最开头的三原色并不是一个定义，此处的三原色指的是构成我们工作的色域范围的三原色在 **CIE 1931 xyz color space**中的坐标。例如我们熟悉的sRGB颜色空间三原色的xy坐标如下：

<image src = https://pic3.zhimg.com/80/v2-21cc1a6b75cf8071f623c21b3c6f908e_720w.jpg />

可以看到，三原色RGB指的是红色R（1，0，0），绿色G（0，1，0），蓝色B（0，0，1）在CIE 1931 xy标准色度图中的xy坐标。三原色构成的三角形涵盖的色域图是我们工作范围的色域图，不同的RGB空间的标准不同，其三原色在CIE 1931 xy色度图中的xy坐标也不同。

以下给出几种常见的颜色空间以及它们的三原色和白点（后面会详细讲白点）的位置

<image src = >