# 显存
GPU内存硬件分类：
1. 在芯片上**On-Chip**
2. 不在芯片上**Off-Chip**

片上内存主要用于缓存（Cache）以及少量特殊存储单元（如Texture）特点是速度快，存储空间小；片下内存主要用于全局存储（global memory），特点是速度相对慢，存储空间大，不同于CPU可扩展内存的设计，GPU的内存硬件大小整体是固定。
## 1. GDDR
GDDR(Graphics Double Data Rate，SDRAM)是一种针对显卡的存储介质。不同于DDR为了满足CPU的运算特点（小数据，多操作）而设计的时延小，不计较是否有大的带宽的设计。GDDR在DDR的基础上增加了带宽，符合GPU运算数据大操作少的特点。

## 2. 设备内部的存储
前面提到GPU存储分为片上存储和片下存储，指的硬件所在位置，为了满足GPU的应用场景，对存储功能进行了细分,包括:局部存储（local memory），全局内存（global memory），常量内存（consatant memory），图像/纹理（texture memory），共享内存（shared memory），寄存器（register），L1/L2 缓存，常量缓存/纹理缓存（constant/texture）。

先介绍几个名词:
- SM（Streaming Multiprocessors）:GPU内数据处理的大单元，好比多核CPU芯片里面的一个核，CPU的一个核一般是运行一个线程，而SM能够运行多个轻量线程。
- nvcc:GPU程序的编译器，其实就是针对CUDA特殊化的GCC编译器；
- block: thread线程的集合单位。比如让GPU完成一个矩阵数据的运算，然后我们给参与运算的thread编个队，队名就叫做Block，对多个block编队就成了grid单位。
- warp:SM里面的运算执行单位，理解为运算时一个warp抓一把thread扔进了计算Core里面进行计算。

### 2.1 全局内存
全局内存（global memory）是数据常用的内存，它能被设备内的所有线程访问，全局共享，为片下（off Chip）内存。和CPU一样，运算单元不能直接的使用全局内存数据，需要经过缓存。
### 2.2 L1/L2 缓存
L1/L2缓存（Cache）数据缓存，和CPU类似。L2为所有SM都能访问到，速度比全局内存快。L1用于存储SM内的数据，SM内的运算单元能够共享，但跨SM之间的L1不能相互访问。
### 2.3 局部内存（local memory） 
局部内存（local memory）是线程独享的内存资源，线程之间不可以相互访问，硬件位置是off chip状态，所以访问速度和全局内存一样。局部内存主要用来解决当寄存器不足时的场景，即在线程申请的变量超过可用寄存器大小时，nvcc会自动将一部分数据放置到片下内存里面。
### 2.4 寄存器（register）
寄存器是线程能独立访问的资源，存储位置为on chip，用来存储一些线程的暂存数据。寄存器的访问速度是最快的，但是容量较小。以目前最新的Ampere架构的GA102为例，每个SM上的寄存器总量256KB，使用时被均分为了4块，且该寄存器块的64KB空间需要被warp中线程平均分配，所以在线程多的情况下，每个线程拿到的寄存器空间相当小。寄存器的分配对SM的占用率（occupancy）存在影响
### 2.5 共享内存（shared memory)
共享内存（shared memory) 是一种在block内能访问的内存，存储硬件位于芯片上（on chip），访问速度较快，共享内存主要是缓存一些需要反复读写的数据。共享内存与L1/L2存在差异。共享内存与L1的位置、速度极其类似，区别在于共享内存的控制与生命周期管理与L1不同，共享内存的使用受用户控制，L1受系统控制，shared memory更利于block之间数据交互。
### 2.6 常量内存（constant memory）
常量内存(constant memory) 是指存储在片下存储的设备内存上，但是通过特殊的常量内存缓存（constant cache）进行缓存读取，常量内存为只读内存。为什么需要设立单独的常量内存？直接用global memory或者shared memory不行吗？

主要是解决一个warp内多线程的访问相同数据的速度太慢的问题。

当所有运算的thread都需要访问一个constant_A的常量，在存储介质上面constant_A的数据只保存了一份，而内存的物理读取方式决定了这么多thread不能在同一时刻读取到该变量，所以会出现先后访问的问题，这样使得并行计算的thread出现了运算时差。常量内存正是解决这样的问题而设置的，它有对应的cache位置产生多个副本，让thread访问时不存在冲突，从而提高并行度。

### 2.7  图像/纹理内存（texture memory）
图像/纹理（texture memory）是一种针对图形化数据的专用内存，其中texture直接翻译是纹理的意思，但根据实际的使用来看texture应该是指通常理解的1D/2D/3D结构数据，相邻数据之间存在一定关系，或者相邻数据之间需要进行相同的运算。 texture内存的构成包含 global + cache + 处理单元，texture为只读内存。texture的优势：
- texture memory 进行图像类数据加载时， warp内的thread访问的数据地址相邻，从而减少带宽的浪费。
- texture 在运算之前能进行一些处理（或者说它本身就是运算），比如聚合、映射等。