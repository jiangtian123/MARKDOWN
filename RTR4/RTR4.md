# RTR4

## 第一章，介绍

实时渲染是一种利用计算机快速生成可靠且真实图像的技术。之所以称为实时渲染，是因为用户在观看时，感觉不出来当前的图像是一张一张生成的，而是沉浸在一个动态的过程中。

图像的生成速率以每秒帧数**FPS**或者赫兹**HZ**来衡量。电子游戏的目标是30，60或者更高的FPS。即每秒生成30，60或者更多的图片。

电影放映的帧率是24帧/秒，但是虚拟现实显示器设备的帧率通常要达到90FPS。

### 1.1 符号和定义

首先我们应该对本书中使用的数学符号进行解释和说明。

#### 1.1.1 数学符号

表1.1 总结了我们将会使用的大部分数学符号，对于其中的一些我们将进行详细的描述。但是需要注意，我们并不一定完全按照表中的规则来使用这些符号。

主要的渲染方程的符号在一些文献中早已有了稳定的表示 **e.g.**,**L**是**radiance**（后面会介绍这个是什么），**E**是**irradiance**，**$$\sigma_1$$**表示散射系数。

角度和标量都是实数，向量和点用粗体小写字母表示，它们的分量表述如下：
$$
V = \left(
 \begin{matrix}
   V_x\\
   V_y \\
   V_z
  \end{matrix}
  \right) \tag{1}
$$
在文中的某些地方我们使用$$(V_x,V_y,V_z)$$来替代$(V_x,V_y,V_z)^T$，因为前者更容易理解。

|            类型             |          符号类型          |                    符号表示                     |
| :-------------------------: | :------------------------: | :---------------------------------------------: |
|         angle(角度)         |       小写的希腊字母       | $$\alpha_i,\phi,\rho,\eta,\gamma_{242},\theta$$ |
|       scalar（标量）        |          小写斜体          |                      a,b,t                      |
| vector or point(向量或者点) |          小写粗体          |           **a,u,$$v_s,(\rho),h_z$$**            |
|        matrix(矩阵)         |          大写粗体          |                   **T（t）**                    |
|         plane(平面)         | $$\pi$$:一个向量和一个标量 |                 $$\pi:n*x+d=0$$                 |
|      triangle(三角形)       |   $$\triangle 3$$points    |             $$\triangle V_0V_1V_2$$             |
|     line segment(线段)      |           两个点           |                    **UV,AB**                    |
| Geometric entity(几何实体)  |          斜体大写          |             $$A_{OBB},T,B_{AABB}$$              |

<center>表1.1</center>

使用齐次坐标法，一个坐标由四个值表示$$V = {(v_x,v_y,v_z,v_w)}^T$$,向量表示为$$V = {(v_x,v_y,v_z,0)}^T$$，点表示为$$V = {(v_x,v_y,v_z,1)}^T$$，有时候，我们也会使用三元变量来表示向量和点，但是我们尽量避免有歧义的表达方式。对于矩阵操作，统一向量和点的表达方式能够带来很大的好处。

一个平面表示为：$$\pi : n*x+d =0$$,n表示平面的法线，d表示该平面到原点的距离。将一个点带入此方程，如果小于0则该点在平面的负平面，大于0在正平面，等于0在平面上。

#### 1.2

[本书的网站](realtimerendering.com)

## 第二章：图形渲染管线

这一部分的核心是渲染管线—**Rendering Pipeline**。渲染管线指的是一个在给定一些三维物体，光源或者其他更多的数据的情况下生成或者渲染一张二维图像的过程。生成图像的过程中，最终物体在画面上呈现的效果受材质属性，光源，纹理和渲染方程的共同作用。

### 2.1 架构

现实世界中管线有很多种表现形式，如工厂的流水线，快餐店。渲染流水线和它们类似，由数个部分组成，每一部分都执行一个很重要的功能。渲染管线大致由四个部分组成

- 应用程序阶段

  传统的应用程序阶段在CPU执行，利用CPU的多核并行处理应用程序阶段各种各样的任务。通常在CPU上执行的一些任务包括

  - 碰撞检测
  - 全局加速算法
  - 动画
  - 物理模拟
  - 向GPU提交渲染数据

- 几何阶段

  到几何阶段就在GPU上执行了它处理的任务有

  - 空间变换
  - 顶点动画
  - 视口转换

- 光栅化阶段

  光栅化阶段主要将三角形离散化其中包括

  - 对三角形排序
  - 面剔除
  - 光栅化
  - 提前深度测试

- 着色阶段

  最后的着色阶段包括

  - 逐像素进行光照计算
  - Late 深度模板测试
  - 透明度混合

  

### 2.2 应用程序阶段

应用程序阶段通常可以由程序员全程控制，因为它在CPU上执行，所以不同的算法对整体流程的效率影响很大。对于现代的GPU来说，可以利用通用计算**Compute Shader**来执行一部分的应用程序阶段的功能。

### 2.3 几何处理阶段

几何处理阶段在GPU上执行，它负责每个三角形的逐顶点操作，包括

- Vertex Shading
- Projection
- Clipping
- Screen Mapping

#### 2.3.1 Vertex Shading

顶点着色器有两个主要任务：

- 计算每个顶点的位置

- 计算程序员想要的每个顶点相关的输出

  例如参与光照计算的 法线和纹理坐标

> 这一部分过于基础，不看了

## 第三章 图形处理单元



